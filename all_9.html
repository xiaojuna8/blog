<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
  
  
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site: ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; </span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="C++.html">C++</a></li>
        
            <li><a href="Xcode.html">Xcode</a></li>
        
            <li><a href="Linux.html">Linux</a></li>
        
            <li><a href="Crypt.html">Crypt</a></li>
        
            <li><a href="Computer.html">Computer</a></li>
        
            <li><a href="genome.html">genome</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15173049144073.html">
                
                  <h1>数据加密方式比较</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>数据加密分为对称加密和非对称加密。</p>

<blockquote>
<p>Symmetric ciphers have good performance, so use them on large data sets.</p>
</blockquote>

<p><a href="https://cromwell-intl.com/cybersecurity/cipher-selection.html">密钥长度和等效的安全性能</a>，文章中特别提到最后一列确实是<code>521</code></p>

<table>
<thead>
<tr>
<th>加密方式</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td>Symmetric Encryption</td>
<td>80</td>
<td>112</td>
<td>128</td>
<td>192</td>
<td>256</td>
</tr>
<tr>
<td>Elliptic Curve encryption</td>
<td>160</td>
<td>224</td>
<td>256</td>
<td>384</td>
<td>521</td>
</tr>
<tr>
<td>RSA (asymmetric encryption)</td>
<td>1024</td>
<td>2048</td>
<td>3072</td>
<td>7680</td>
<td>15380</td>
</tr>
</tbody>
</table>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/1/30</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Crypt.html'>Crypt</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15173049144311.html">
                
                  <h1>文件加密解密流程</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>对于磁盘上的文件进行加密和解密操作，考虑到磁盘IO速度和加密速度差异，多线程处理能达到较合理的速度。若一次完整读取整个文件到内存，再加密存储，这对于大文件来讲，比较浪费内存。</p>

<h2 id="toc_0">单线程</h2>

<ol>
<li>文件分块读取到内存</li>
<li>内存中数据加密</li>
<li>分块加密数据写入磁盘</li>
</ol>

<p>此时加密时间为，读取时间+加密时间+写入时间</p>

<h2 id="toc_1">多线程</h2>

<p>分为三类线程，申请n块内存。</p>

<ol>
<li>主线程：磁盘数据读取到内存</li>
<li>加密线程：内存数据加密</li>
<li>写文件线程：内存加密数据写入磁盘</li>
</ol>

<p>定义内存块状态 <code>atomic_int flag</code> </p>

<pre><code class="language-c">0:free
1:reading file
2:reading complete
3:encrypt data
4:encrypt complete
5:writing data
6:writing complete
</code></pre>

<p>定义内存块编号<code>atomic_int seqID</code>，表示该内存块是原磁盘文件的第几块。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/1/30</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Crypt.html'>Crypt</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15173049144364.html">
                
                  <h1>椭圆曲线密码学</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p><strong>Elliptic-curve cryptography</strong> (<strong>ECC</strong>) is an approach to <a href="https://en.wikipedia.org/wiki/Public-key_cryptography">public-key cryptography</a> based on the <a href="https://en.wikipedia.org/wiki/Algebraic_structure">algebraic structure</a> of <a href="https://en.wikipedia.org/wiki/Elliptic_curve">elliptic curves</a> over <a href="https://en.wikipedia.org/wiki/Finite_field">finite fields</a>. ECC requires smaller keys compared to non-ECC cryptography (based on plain <a href="https://en.wikipedia.org/wiki/Galois_field">Galois fields</a>) to provide equivalent security</p>

<p><a href="http://andrea.corbellini.name/2015/05/23/elliptic-curve-cryptography-finite-fields-and-discrete-logarithms/">参考文章</a></p>

<ul>
<li>
<a href="#toc_0">椭圆曲线</a>
</li>
<li>
<a href="#toc_1">椭圆曲线群</a>
</li>
<li>
<a href="#toc_2">有限域椭圆曲线</a>
<ul>
<li>
<a href="#toc_3">点与点加法</a>
<ul>
<li>
<a href="#toc_4">取模运算</a>
</li>
<li>
<a href="#toc_5">代数方法</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">椭圆曲线群阶数</a>
</li>
<li>
<a href="#toc_7">点的数乘</a>
</li>
<li>
<a href="#toc_8">子群阶数</a>
<ul>
<li>
<a href="#toc_9">定义</a>
</li>
<li>
<a href="#toc_10">性质</a>
</li>
<li>
<a href="#toc_11">计算</a>
</li>
<li>
<a href="#toc_12">寻找基点</a>
</li>
</ul>
</li>
<li>
<a href="#toc_13">离散对数</a>
</li>
</ul>
</li>
<li>
<a href="#toc_14">ECDH&amp;ECDSA</a>
<ul>
<li>
<a href="#toc_15">定义参数</a>
</li>
<li>
<a href="#toc_16">随机曲线</a>
</li>
<li>
<a href="#toc_17">椭圆曲线加密(ECC)</a>
<ul>
<li>
<a href="#toc_18">ECDH</a>
<ul>
<li>
<a href="#toc_19">Playing with ECDH</a>
</li>
<li>
<a href="#toc_20">ECDSA数字签名</a>
<ul>
<li>
<a href="#toc_21">证明</a>
</li>
<li>
<a href="#toc_22">k的重要性</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_23">打破安全性</a>
<ul>
<li>
<a href="#toc_24">Baby-step，giant-step</a>
</li>
<li>
<a href="#toc_25">Baby-step实例</a>
</li>
<li>
<a href="#toc_26">Shor  Algorithm</a>
</li>
<li>
<a href="#toc_27">ECC and RSA</a>
</li>
</ul>
</li>
<li>
<a href="#toc_28">其它曲线</a>
<ul>
<li>
<a href="#toc_29">Koblitz curves over binary fields</a>
</li>
<li>
<a href="#toc_30">Binary curves</a>
</li>
<li>
<a href="#toc_31">Curve25519 和 Ed25519</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<h2 id="toc_0">椭圆曲线</h2>

<p>数学上，椭圆曲线为一代数曲线，形如</p>

<p><img src="https://gitee.com/uploads/images/2017/1128/150534_a238aa67_1453931.png" alt="椭圆曲线" title="ECClines-3.svg.png"/></p>

<p>\[y^2 = x^3 + ax + b\]</p>

<p>并且该曲线无奇点(尖点或自相交)，判别式\(\Delta = -16(4a^3+27b^2)\)不为0.</p>

<h2 id="toc_1">椭圆曲线群</h2>

<p>在椭圆曲线中添加无穷远点<code>O</code>,由于曲线关于y轴对称，假设P为曲线上一点，则P关于y轴的对称点定义为-P。无穷远点的对称点为其自身，因此<code>O = -O</code></p>

<p>定义<code>+</code>运算，假设P，Q，-R在曲线上，则<code>P + Q = -R -&gt; P + Q + R = O</code>其中-R与P，Q共线。</p>

<p><img src="https://gitee.com/uploads/images/2017/1128/150608_f0b901e7_1453931.png" alt="椭圆曲线加法" title="ECClines.svg.png"/></p>

<p>定义数乘<code>*</code></p>

<p>\[<br/>
nP = \underbrace{P + P + \cdots + P}_{n\ \text{times}}<br/>
\]</p>

<h2 id="toc_2">有限域椭圆曲线</h2>

<p>\[y^2 = x^3 + ax+ b \bmod{p}\]</p>

<p>下图是曲线\(y^2 = x^3  -7x+10\bmod{p}\)，其中p为19，97，127，487时的点集。可看到点集关于y = p/2对称。</p>

<p><img src="https://gitee.com/uploads/images/2017/1128/152520_921b2a37_1453931.png" alt="有限域" title="elliptic-curves-mod-p.png"/></p>

<h3 id="toc_3">点与点加法</h3>

<p>定义直线\(ax+bx+c \equiv  0 \bmod{p}\)，既等间距的直线族。</p>

<p><img src="https://gitee.com/uploads/images/2017/1128/153512_8d9c2b0e_1453931.png" alt="有限域直线" title="point-addition-mod-p.png"/></p>

<p>若点集中P,Q,-R三点在同一直线上，则<code>P+Q+R = O</code></p>

<h4 id="toc_4">取模运算</h4>

<ul>
<li>\((18 +9)\ mod\ 23 =4 \)</li>
<li>\((7 - 14)\ mod\ 23 =16 \)</li>
<li>\((4 * 7)\ mod\ 23 =5 \)</li>
<li>\((9^{-1})\ mod\ 23 =18 \)</li>
</ul>

<p>\((9*9^{-1})\ mod\ 23 = 1 = (9*18)mod\ 23\)</p>

<h4 id="toc_5">代数方法</h4>

<p>\(P = (x_p,y_p)\)</p>

<p>\(Q = (x_q,y_q)\)</p>

<p>\(R = (x_r,y_r)\)</p>

<p>\[P+Q = -R\]</p>

<p>公式</p>

<p>\[<br/>
x_r = (m^2-x_p-x_q) \bmod{p}<br/>
\]</p>

<p>\[<br/>
y_r = [y_p+m(x_r-x_p)]\bmod{p}<br/>
\]</p>

<p>若\(P \neq Q \)则\(m = (y_p - y_q)(x_p-x_q)^{-1}\bmod{p}\)</p>

<p>若\(P = Q\)则\(m = (3x_p^2+a)(2y_p)^{-1}\bmod{p}\)</p>

<h3 id="toc_6">椭圆曲线群阶数</h3>

<p>点集中点的数量称为椭圆曲线的阶数，有快速算法<a href="https://en.wikipedia.org/wiki/Schoof%27s_algorithm">Schoof&#39;s algorithm</a></p>

<h3 id="toc_7">点的数乘</h3>

<p>\[nP = \underbrace{P + P + \cdots + P}_{n\ \text{times}}\]</p>

<p>例如曲线\(y^2 \equiv x^3 + 2x + 3 \bmod{97}\)的点\(P = (3,6)\)</p>

<ul>
<li>\(0P = O = (\infty,\infty)\)</li>
<li>\(1P = P = (3,6)\)</li>
<li>\(2P = P + P = (80,10)\)</li>
<li>\(3P = 2P +P = (80,87)\)</li>
<li>\(4P = 2*2P = (3,91)\)</li>
<li>\(5P = O\)</li>
<li>\(6P = 5P +P = P\)</li>
<li>\(7P = 5P+2P = 2P\)</li>
<li>\(8P = 5P +3P =3P\)</li>
<li>\(9P = 5P + 4P = 4P\)</li>
<li>...</li>
</ul>

<p>通过上边例子可以看出P与数乘，最终只有有限的循环出现的几个结果\(kP = (k\bmod{5})P\),这五点在加法运算下封闭。这五点构成了<strong>循环子群</strong>，其中P称为<strong>generator</strong> or <strong>base point</strong> of the cyclic subgroup</p>

<p>Cyclic subgroups are the foundations of ECC and other cryptosystems. </p>

<h3 id="toc_8">子群阶数</h3>

<h4 id="toc_9">定义</h4>

<p><strong>the order of  is the smallest positive integer \(n\) such that \(nP = 0\)</strong>. In fact, if you look at the previous example, our subgroup contained five points, and we had \(5P = 0\).</p>

<h4 id="toc_10">性质</h4>

<p>The order of  \(P\) is linked to the order of the elliptic curve by <a href="https://en.wikipedia.org/wiki/Lagrange%27s_theorem_(group_theory)">Lagrange&#39;s theorem</a>, which states that <strong>the order of a subgroup is a divisor of the order of the parent group</strong>.</p>

<p>In other words, if an elliptic curve contains  \(N\) points and one of its subgroups contains  \(n\) points, then \(n\) is a divisor of \(N\), so \(N\ mod\ n \equiv 0\)</p>

<h4 id="toc_11">计算</h4>

<ol>
<li>用Schoof&#39;s algorithm计算椭圆曲线阶数\(N\)</li>
<li>找到所有\(N\)的因子</li>
<li>求每个\(N\)因子\(n\)与\(P\)乘积\(nP\)</li>
<li>最小的\(n\)就是子群的阶数</li>
</ol>

<p>For example, the curve \(y^2 = x^3-x+3\) over the field \(F_{37}\)  has order \(N = 42\) . Its subgroups may have order 1,2,3,6,7,14,21 and 42 . If  we try \(P = (2,3)\) can see that \(1P\neq0,2P\neq0,3P\neq0,6P\neq0,7P=0,\) so the order of  is 7.</p>

<h4 id="toc_12">寻找基点</h4>

<p>对于ECC算法，我们希望子群阶数足够高。所以通常我们选择一条椭圆曲线，计算其阶数，并选择一个较大的因子作为子群的阶数，最终找到一个基点。</p>

<p>在Lagrange&#39;s theorem中令\(h =N/n\),称\(h\)为<strong>cofactor of the subgroup</strong>余因子</p>

<p>由于\(nP = 0\)所以\(h(nP) = 0 = n(hP)\)</p>

<p>现在考虑\(n\)是素数,令\(G =hP\),则生成一个以\(G\)为基点的n阶子群</p>

<ol>
<li>计算椭圆曲线阶数\(N\)</li>
<li>选择\(N\)的素因子\(n\)</li>
<li>计算cofactor \(h = N/n\)</li>
<li>随机在曲线上选择一个点\(P\)</li>
<li>计算\(G = hP\)</li>
<li>如果\(G =0\),从第四步从新选择另外点\(P\).至此我们找到了以\(G\)为基点的\(n\)阶子群</li>
</ol>

<h3 id="toc_13">离散对数</h3>

<p>现已知点PQ在椭圆曲线上，如何确定整数\(k\)使得\(Q =kP\) ?这个问题被称为椭圆曲线的离散对数问题，这个问题被认为是一个困难的问题，目前还没有多项式时间解决方法。</p>

<p>在密码学中Digital Signature Algorithm (DSA), the Diffie-Hellman key exchange (D-H) and the ElGamal algorithm都与该问题有关。</p>

<blockquote>
<p>What makes ECC interesting is that, as of today, the discrete logarithm problem for elliptic curves seems to be &quot;harder&quot; if compared to other similar problems used in cryptography. </p>
</blockquote>

<p>ECC问题相比其它几个问题更难以解决。</p>

<h2 id="toc_14">ECDH&amp;ECDSA</h2>

<h3 id="toc_15">定义参数</h3>

<p>Our elliptic curve algorithms will work in a cyclic subgroup of an elliptic curve over a finite field. </p>

<ul>
<li>素数\(p\)确定有限域</li>
<li>参数\(a,b\)确定椭圆曲线</li>
<li>基点\(G\)生成子群</li>
<li>子群阶数\(n\)</li>
<li>子群余因子\(h\)</li>
</ul>

<p>得到算法六元组\((p,a,b,G,n,h)\)</p>

<h3 id="toc_16">随机曲线</h3>

<p>在前面提到离散对数问题非常困难，但也不是所有的都困难，有些类型的椭圆曲线就非常脆弱，有非常快速的方法解决，例如\(p = hn\)时就有多项式时间解决的方法。</p>

<p><strong>怎样保证曲线是安全的呢？</strong></p>

<p>为了解决这个问题，我们需要再附加一个参数<em>seed</em>\(S\)，这是一个随机数涌来生成参数a和b，或者基点G再或者所有的参数。这些参数通过hash函数生成，hash容易计算但是难以逆推。</p>

<p><img src="https://gitee.com/uploads/images/2017/1128/182121_00732b52_1453931.png" alt="ab生成" title="random-parameters-generation.png"/></p>

<p><img src="https://gitee.com/uploads/images/2017/1128/182143_9a77aa05_1453931.png" alt="参数逆推" title="seed-inversion.png"/></p>

<p>椭圆曲线的生成通过随机数生成，这使得曲线足够的随机。</p>

<h3 id="toc_17">椭圆曲线加密(ECC)</h3>

<ul>
<li>The <strong>private key</strong> is a random integer \(d\) chosen from \(\{1,2\cdots n-1\}\) (where \(n\) is the order of the subgroup).</li>
<li>The <strong>public key</strong> is the point \(H=dG\) (where \(G\) is the base point of the subgroup).</li>
</ul>

<p>如果我们知道\(d\)和\(G\),计算\(H\)非常容易。但是如果我们仅知道\(H\)和\(G\),计算\(d\)将非常困难，因为这是离散对数问题。</p>

<h4 id="toc_18">ECDH</h4>

<p>ECDH是 <a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">Diffie-Hellman algorithm</a>的一种变体，更像密钥交换协商而不是加密。应用场景：双方需要安全的交换信息，即使第三方拦截到也无法破译。这是TSL背后的一个原则。</p>

<ol>
<li> <strong>Alice and Bob generate their own private and public keys</strong>.对于Alice私钥\(d_A\)公钥\(H_A = d_AG\)，对于Bob私钥\(d_B\)公钥\(H_B=d_BG\),Alice&amp;Bob使用共同的参数：共同的基点，相同的曲线，相同的有限域。</li>
<li> <strong>Alice and Bob exchange their public keys \(H_A\) and \(H_B\) over an insecure channel</strong>.即使中间者截获了公钥\(H_A\&amp;H_B\)，除非解决离散对数问题否则不能知道私钥\(d_A\&amp;d_B\)</li>
<li> <strong>Alice calcuates \(S = d_AH_B\),Bob calculates \(S=d_BH_A\)</strong>.注意到他们获得的\(S\)是相同的。</li>
</ol>

<p>\[S=d_AH_B=d_A(d_BG)=d_B(d_AG)=d_BH_A\]</p>

<h5 id="toc_19">Playing with ECDH</h5>

<ul>
<li>\(p\)=0xffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f</li>
<li>\(a\)=0</li>
<li>\(b\)=7</li>
<li>\(x_G\)=0x79be667e f9dcbbac 55a06295 ce870b07 029bfcdb 2dce28d9 59f2815b 16f81798</li>
<li>\(y_G\)=0x483ada77 26a3c465 5da4fbfc 0e1108a8 fd17b448 a6855419 9c47d08f fb10d4b8</li>
<li>\(n\)=0xffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141</li>
<li>\(h\)=1</li>
</ul>

<blockquote>
<pre><code class="language-c">Curve: secp256k1
Alice&#39;s private key: 0xe32868331fa8ef0138de0de85478346aec5e3912b6029ae71691c384237a3eeb
Alice&#39;s public key: (0x86b1aa5120f079594348c67647679e7ac4c365b2c01330db782b0ba611c1d677, 0x5f4376a23eed633657a90f385ba21068ed7e29859a7fab09e953cc5b3e89beba)
Bob&#39;s private key: 0xcef147652aa90162e1fff9cf07f2605ea05529ca215a04350a98ecc24aa34342
Bob&#39;s public key: (0x4034127647bb7fdab7f1526c7d10be8b28174e2bba35b06ffd8a26fc2c20134a, 0x9e773199edc1ea792b150270ea3317689286c9fe239dd5b9c5cfd9e81b4b632)
Shared secret: (0x3e2ffbc3aa8a2836c1689e55cd169ba638b58a3a18803fcf7de153525b28c3cd, 0x43ca148c92af58ebdb525542488a4fe6397809200fe8c61b41a105449507083)
</code></pre>
</blockquote>

<h5 id="toc_20">ECDSA数字签名</h5>

<p>Alice使用私钥\(d_A\)签名文件，Bob使用Alice的共钥\(H_A\)来确认。</p>

<p>ECDSA作用在消息的hash上，而不是直接作用在消息上。Hash函数可以选择密码学安全的。hash需要被截断为和子群阶数\(n\)所占bit一样的长度，例如前边n是256bit，那么hash也需要是256bit，截断后的hash定义为整数\(z\)</p>

<ol>
<li>随机选择\(k\in\{1,2\cdots,n-1\}\),n是子群阶数</li>
<li>计算点\(P= kG\) ,G是子群基点</li>
<li>计算\(r=x_p\bmod{n}\),其中\(x_p\)是P的x坐标</li>
<li>如果\(r=0\)重新选择k</li>
<li>计算\(s=k^{-1}(z+rd_A)\bmod{n}\) 其中\(d_A\)是Alice的私钥</li>
<li>如果\(s=0\)重新选择k</li>
</ol>

<p>\((r,s)\) 就是签名。</p>

<p><img src="https://gitee.com/uploads/images/2017/1129/093205_3b1b1f14_1453931.png" alt="ECDSA" title="ecdsa.png"/></p>

<p>Alice对hash \(z\) 使用私钥 \(d_A\) 和随机数 \(j\)签名。Bob使用Alice的共钥 \(H_A\)验证。</p>

<p>验证签名，验证签名需要Alice的共钥 \(H_A\) 截断的hash \(z\)，以及签名 \((r,s)\).</p>

<ol>
<li>计算整数 \(u_1=(s^{-1}z)\bmod{n}\)</li>
<li>计算整数 \(u_2=(s^{-1}r)\bmod{n}\)</li>
<li>计算点 \(P=u_1G+u_2H_A\)</li>
</ol>

<p>如果 \(r=x_P\bmod{n}\)则是合法的</p>

<h6 id="toc_21">证明</h6>

<p>\[<br/>
\begin{array}{rl}<br/>
  P &amp; = u_1 G + u_2 H_A \\<br/>
  &amp; = u_1 G + u_2 d_A G \\<br/>
  &amp; = (u_1 + u_2 d_A) G<br/>
\end{array}<br/>
\]</p>

<p>再带入 \(u_1,u_2\)的定义<br/>
\[<br/>
\begin{array}{rl}<br/>
  P &amp; = (u_1 + u_2 d_A) G \\<br/>
  &amp; = (s^{-1} z + s^{-1} r d_A) G \\<br/>
  &amp; = s^{-1} (z + r d_A) G<br/>
\end{array}<br/>
\]<br/>
这里省略了\(mod\ n\)，因为在子群阶数为\(n\),所以相当于自动对n取模。由\(s = k^{-1} (z + rd_A) \bmod{n}\)推出\(k = s^{-1} (z + rd_A)\bmod{n}\).<br/>
\[<br/>
\begin{array}{rl}<br/>
  P &amp; = s^{-1} (z + r d_A) G \\<br/>
  &amp; = k G<br/>
\end{array}<br/>
\]</p>

<p>这与签名算法第二步生成的是同一个点P，接下来验证是否满足生成算法第三步即可验证签名。</p>

<h6 id="toc_22">k的重要性</h6>

<p>当使用ECDSA进行数字签名时，k要相当饱满。如果每次签名都使用相同的k，或者k是可预测的，那么就被找出私钥。<a href="http://www.bbc.com/news/technology-12116051">This is the kind of mistake made by Sony a few years ago.</a>，PS3只能运行Sony使用ECDSA签名过的程序，但问题是Sony使用了固定的k</p>

<p>这样可以轻松的找出Sony的私钥\(d_S\)，只要买两份签名的游戏，取出他们的hash (\(z_1 z_2\)),和两份签名\((r_1,s_1),(r_2,s_2)\),以及椭圆参数。</p>

<ol>
<li>\(r_1=r_2\)</li>
<li>根据签名步骤5，考虑 \((s_1-s_2)\bmod{n} = k^{-1}(z_1-z_2)\bmod{n}\)</li>
<li>等式两边乘以\(k\),得到\(k(s_1-s_2)\bmod{n} = (z_1-z_2)\bmod{n}\)</li>
<li>两边除以\((s_1-s_2)\)得到\(k=(z_1-z_2)(s_1-s_2)^{-1}\bmod{n}\)</li>
</ol>

<p>\[<br/>
s = k^{-1}(z+rd_S)\bmod{n}\Rightarrow d_S = r^{-1}(sk-z)\bmod{n}<br/>
\]</p>

<h3 id="toc_23">打破安全性</h3>

<p>我们认为离散对数问题是非常困难的，但是并没有数学上的证明。目前解决离散对数问题由三种方法，假设\(Q=xP\)，求x</p>

<h4 id="toc_24">Baby-step，giant-step</h4>

<p>随意假定\(x=am+b\)<br/>
\[<br/>
\begin{array}{rl}<br/>
  Q &amp; = xP \\<br/>
  Q &amp; = (am + b) P \\<br/>
  Q &amp; = am P + b P \\<br/>
  Q - am P &amp; = b P<br/>
\end{array}<br/>
\]<br/>
1. 计算\(m=\lceil\sqrt{n}\rceil\)<br/>
2. 对于每个\(b\in\{0,1\cdots m\}\)计算\(bP\)<br/>
3. 对于每个\(a\in\{0,1\cdots m\}\)<br/>
  1. 计算\(amP\)<br/>
  2. 计算\(Q-amp\)<br/>
  3. 检查是否存在\(bP\)使得\(Q-amp = bP\)<br/>
  4. 如果存在那么就找到了\(x=am+b\)</p>

<h4 id="toc_25">Baby-step实例</h4>

<p>选择一条标准曲线<code>prime192v1</code>,\(n\)=0xffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831,\(\sqrt{n} \approx 7.9\cdot10^{28}\)，每个点需要32Byte存储，大概总共需要\(2.5\cdot10^{30}\)byte，这比全世界存储还多。而且<code>prime192v1</code>还是一个低阶曲线。</p>

<h4 id="toc_26">Shor  Algorithm</h4>

<p>使用量子算法可让复杂度降低\(O((\log{n})^3)\)</p>

<h4 id="toc_27">ECC and RSA</h4>

<table>
<thead>
<tr>
<th>RSA key size （bits）</th>
<th>ECC key size （bits）</th>
</tr>
</thead>

<tbody>
<tr>
<td>1024</td>
<td>160</td>
</tr>
<tr>
<td>2048</td>
<td>224</td>
</tr>
<tr>
<td>3072</td>
<td>256</td>
</tr>
<tr>
<td>7680</td>
<td>384</td>
</tr>
<tr>
<td>15360</td>
<td>521</td>
</tr>
</tbody>
</table>

<h3 id="toc_28">其它曲线</h3>

<h4 id="toc_29">Koblitz curves over binary fields</h4>

<p>\(y^2+xy=x^3+ax^2+1\) a为0或1，拥有\(2^m\)点，其中m为素数</p>

<h4 id="toc_30">Binary curves</h4>

<p>\(x^2+xy=x^3+x^2+b\) b是随机生成的整数</p>

<h4 id="toc_31">Curve25519 和 Ed25519</h4>

<p>这两条曲线计算较快。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2018/1/30</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Crypt.html'>Crypt</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="all_8.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="all_10.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1></h1>
                <div class="site-des"></div>
                <div class="social">











  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="C++.html"><strong>C++</strong></a>
        
            <a href="Xcode.html"><strong>Xcode</strong></a>
        
            <a href="Linux.html"><strong>Linux</strong></a>
        
            <a href="Crypt.html"><strong>Crypt</strong></a>
        
            <a href="Computer.html"><strong>Computer</strong></a>
        
            <a href="genome.html"><strong>genome</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15173054141309.html">Illumina Sequencing</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15173054141798.html">Illumina二代测序原理</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15173054025402.html">DNA基本关系</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15173053129472.html">字符编码</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15173052079033.html">跨平台C／C++系统／编译器检测</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
